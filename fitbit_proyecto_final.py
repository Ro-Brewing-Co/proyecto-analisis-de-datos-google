# -*- coding: utf-8 -*-
"""fitbit-proyecto-final.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/18suwhsYi0DzhjeuDQp_UQz3OzGYUYEgC
"""

# This Python 3 environment comes with many helpful analytics libraries installed
# It is defined by the kaggle/python Docker image: https://github.com/kaggle/docker-python
# For example, here's several helpful packages to load

import numpy as np # linear algebra
import pandas as pd # data processing, CSV file I/O (e.g. pd.read_csv)


# Input data files are available in the read-only "../input/" directory
# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory

import os
for dirname, _, filenames in os.walk('/kaggle/input'):
    for filename in filenames:
        print(os.path.join(dirname, filename))

# You can write up to 20GB to the current directory (/kaggle/working/) that gets preserved as output when you create a version using "Save & Run All"
# You can also write temporary files to /kaggle/temp/, but they won't be saved outside of the current session

pip install dash plotly panda

"""# Caso pr√°ctico 2: ¬øC√≥mo puede hacer una empresa tecnolog√≠a para el bienestar para tomar decisiones inteligentes?

## Introducci√≥n

¬°Bienvenido al caso pr√°ctico de an√°lisis de datos de Bellabeat! En este caso pr√°ctico, realizar√°s muchas tareas del mundo real, t√≠picas de un analista de datos j√∫nior. Imaginar√°s que trabajas para Bellabeat, un fabricante de productos de alta tecnolog√≠a orientados a la salud de la mujer, y conocer√°s a diferentes personajes y miembros del equipo. Para responder a las preguntas clave de la empresa, seguir√°s los pasos del proceso de an√°lisis de datos: preguntar, preparar, procesar, analizar, compartir y actuar. En este proceso, las tablas del mapa de ruta de caso pr√°ctico, incluidas las preguntas orientativas y las tareas clave, te ayudar√°n a mantenerte en el camino correcto.

Al final de esta lecci√≥n, tendr√°s un caso pr√°ctico listo para el portfolio. Descarga el paquete y consulta los detalles de este caso pr√°ctico en cualquier momento. As√≠, cuando empieces a buscar trabajo, tu caso pr√°ctico ser√° una forma tangible de demostrar tus conocimientos y habilidades a los posibles empleadores.

## Escenario

Eres un analista de datos j√∫nior que trabaja en el equipo de analistas de marketing de Bellabeat, fabricante de productos de alta tecnolog√≠a orientados a la salud de la mujer. Bellabeat es una empresa peque√±a exitosa, pero tiene el potencial para convertirse en un actor m√°s grande en el mercado global de dispositivos inteligentes. Ur≈°ka Sr≈°en, cofundadora y directora creativa de Bellabeat, cree que analizar los datos de actividad f√≠sica de los dispositivos inteligentes podr√≠a desplegar nuevas oportunidades de negocio para la empresa. Te han pedido que te concentres en uno de los productos de Bellabeat y analices los datos de los dispositivos inteligentes para conocer el uso que hacen los consumidores de sus dispositivos inteligentes. Los hallazgos que descubras ayudar√°n a orientar la estrategia de marketing de la empresa. Presentar√°s tu an√°lisis al equipo ejecutivo de Bellabeat junto con tus recomendaciones de alto nivel para la estrategia de marketing de Bellabeat.

## Personajes y productos

### Personajes
- **Ur≈°ka Sr≈°en**: Cofundadora y directora creativa de Bellabeat.
- **Sando Mur**: Matem√°tico y cofundador de Bellabeat, miembro clave del equipo ejecutivo.
- **Equipo de an√°lisis computacional de datos de marketing**: Equipo encargado de recopilar, analizar e informar datos que gu√≠an la estrategia de marketing.

### Productos
- **Aplicaci√≥n Bellabeat**: Monitorea actividad f√≠sica, sue√±o, estr√©s, ciclo menstrual y h√°bitos de conciencia plena.
- **Leaf**: Dispositivo de seguimiento cl√°sico para actividad f√≠sica, sue√±o y estr√©s.
- **Time**: Reloj inteligente que combina dise√±o cl√°sico y seguimiento de bienestar.
- **Spring**: Botella de agua inteligente para seguimiento de hidrataci√≥n.
- **Membres√≠a Bellabeat**: Programa de orientaci√≥n personalizada en nutrici√≥n, actividad f√≠sica, sue√±o y conciencia plena.

## Acerca de la empresa

Bellabeat fue fundada por Ur≈°ka Sr≈°en y Sando Mur en 2013 con el objetivo de desarrollar productos tecnol√≥gicos orientados al bienestar de la mujer. Creci√≥ r√°pidamente y se posicion√≥ como una empresa l√≠der en tecnolog√≠a de bienestar femenino. Bellabeat vende sus productos en tiendas minoristas y online, empleando marketing tradicional y digital, con un enfoque particular en publicidad en Google Search, Facebook, Instagram, Twitter, YouTube y Google Display Network.

## Preguntar

Sr≈°en solicita que analices los datos de dispositivos inteligentes externos para aplicarlos a un producto Bellabeat espec√≠fico. Tus an√°lisis deben responder:

1. ¬øCu√°les son algunas tendencias de uso de dispositivos inteligentes?
2. ¬øC√≥mo aplicar estas tendencias a los clientes de Bellabeat?
3. ¬øC√≥mo estas tendencias pueden influir en la estrategia de marketing de Bellabeat?

Crear√°s un informe con:

- Resumen claro de la tarea empresarial.
- Fuentes de datos utilizadas.
- Limpiezas y manipulaciones de datos.
- An√°lisis resumido.
- Visualizaciones clave.
- Tres recomendaciones de contenido de alto nivel.

## Preguntar

- **Pregunta clave:** ¬øCu√°l es el problema que intentas resolver?
- **Tareas clave:** Identificar la tarea empresarial e interesados clave.
- **Entregable:** Una instrucci√≥n clara de la tarea empresarial.

## Preparar

Usar√°s datos p√∫blicos como:
- Datos de seguimiento de actividad f√≠sica Fitbit (Kaggle, CC0).

- **Tareas clave:** Descarga y almacenamiento de datos, organizaci√≥n, orden y filtrado, evaluar credibilidad.
- **Entregable:** Descripci√≥n detallada de fuentes utilizadas.

## Procesar

- Descarga, organiza, limpia y filtra los datos.
- **Entregable:** Documentaci√≥n de limpieza y manipulaci√≥n.

## Analizar

- Explora datos para descubrir tendencias o relaciones.
- **Entregable:** Resumen del an√°lisis.

## Compartir

- Visualiza datos para comunicar hallazgos clave.
- **Entregable:** Visualizaciones y hallazgos clave.

## Actuar

- Resume conclusiones y ofrece recomendaciones de estrategia.
- **Entregable:** Tres recomendaciones de alto nivel basadas en tu an√°lisis.

## Preguntar:

Pregunta clave: ¬øCu√°l es el problema que intentas resolver?

Tareas clave: Identificar la tarea empresarial e interesados clave.

Entregable: Una instrucci√≥n clara de la tarea empresarial.

Aqu√≠ te dejo el contenido perfectamente estructurado para la **primera parte del an√°lisis de datos**, siguiendo el enfoque solicitado:

---

## Primera Parte del An√°lisis de Datos

---

### **Pregunta Clave**  
**¬øCu√°l es el problema que intentas resolver?**

Bellabeat desea **aumentar la retenci√≥n y el compromiso de sus usuarias** mediante un an√°lisis profundo de los datos de uso de sus dispositivos inteligentes. El problema central es identificar **c√≥mo los diferentes patrones de actividad f√≠sica influyen en la fidelidad de las usuarias** y utilizar esta informaci√≥n para dise√±ar **estrategias personalizadas que incrementen la satisfacci√≥n y reduzcan la deserci√≥n (churn)**.

---

### **Tareas Clave**
1. **Identificar la tarea empresarial**  
   - Mejorar la **retenci√≥n de usuarias** y promover el uso de funcionalidades premium en la app de Bellabeat.
   - Entender los **diferentes perfiles de usuarias** seg√∫n su nivel de actividad f√≠sica.
   - Proporcionar **recomendaciones personalizadas** basadas en los datos de actividad registrados.

2. **Identificar a los interesados clave**  
   - **Equipo de Marketing**: Encargado de dise√±ar campa√±as y estrategias de retenci√≥n basadas en los perfiles de usuario detectados.
   - **Equipo de Producto**: Responsable de implementar nuevas funcionalidades en la app Bellabeat seg√∫n las recomendaciones obtenidas.
   - **Equipo de UX/UI**: Adaptaci√≥n de la experiencia de usuario seg√∫n el comportamiento y las necesidades detectadas.
   - **Equipo Directivo**: Tomadores de decisi√≥n para asignaci√≥n de recursos y priorizaci√≥n de iniciativas.

---

### **Entregable: Una Instrucci√≥n Clara de la Tarea Empresarial**

**Tarea Empresarial:**  
Analizar los datos de actividad f√≠sica registrados por los dispositivos Bellabeat para **identificar patrones de uso** y **segmentar a las usuarias en grupos relevantes**, con el fin de desarrollar **estrategias personalizadas** que incrementen la **retenci√≥n**, el **uso diario de la app y los dispositivos**, y fomenten la conversi√≥n hacia productos o planes **premium**.
"""

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from math import ceil

"""## Preparar

Usar√°s datos p√∫blicos como:
- Datos de seguimiento de actividad f√≠sica Fitbit (Kaggle, CC0).

- **Tareas clave:** Descarga y almacenamiento de datos, organizaci√≥n, orden y filtrado, evaluar credibilidad.
- **Entregable:** Descripci√≥n detallada de fuentes utilizadas.
"""

df = pd.read_csv('/content/dailyActivity_merged.csv')

df.head()

df.info()

"""## Analizar

- Explora datos para descubrir tendencias o relaciones.
- **Entregable:** Resumen del an√°lisis.
"""

df['ActivityDate'] = pd.to_datetime(df['ActivityDate'])
df.dtypes

"""## Valores √∫nicos"""

df.nunique().sort_values()

"""## Duplicados"""

df.duplicated().sum()

"""## Nulos"""

df.isna().sum().sort_values()

"""# EDA

## An√°lisis estad√≠sticos
"""

def estadisticos_cont(df):
    estadisticos = df.describe().T
    estadisticos['median'] = df.median()
    return(estadisticos)

estadisticos_cont(df)

# Calcular la matriz de correlaci√≥n
correlation_matrix = df.corr()

# Crear la figura para el heatmap
plt.figure(figsize=(12, 8))

# Generar el mapa de calor (heatmap)
sns.heatmap(correlation_matrix,
            annot=True,        # Muestra los valores dentro de cada celda
            cmap='coolwarm',   # Esquema de colores para los valores positivos/negativos
            linewidths=0.5,    # Separaci√≥n entre celdas
            fmt='.2f'          # Formato de los n√∫meros (2 decimales)
           )

# T√≠tulo del gr√°fico
plt.title('Matriz de Correlaci√≥n - Bellabeat Dataset', fontsize=16)

# Mostrar el gr√°fico
plt.show()

num = df.loc[:,'TotalSteps':]
num

"""## Compartir

- Visualiza datos para comunicar hallazgos clave.
- **Entregable:** Visualizaciones y hallazgos clave.
"""

def variables_continuas(num):
    filas = ceil(num.shape[1] / 2)
    f, ax = plt.subplots(nrows=filas, ncols=2, figsize=(16, 24))
    ax = ax.flat

    for cada, variable in enumerate(num):
        num[variable].plot.density(ax=ax[cada])
        ax[cada].set_title(variable, fontsize=12, fontweight='bold')
        ax[cada].tick_params(labelsize=12)

    plt.tight_layout()
    plt.show()

variables_continuas(num)

"""## üìã **Tabla de Variables Analizadas en el Proyecto Bellabeat**

| **Variable**                | **Descripci√≥n del Dato**                                                       | **An√°lisis de Distribuci√≥n**                                                                                           |
|-----------------------------|--------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------|
| **TotalSteps**              | Total de pasos registrados por d√≠a.                                            | Distribuci√≥n sesgada a la derecha. Mayor√≠a en 8000-15000 pasos. Valores negativos presentes (requieren limpieza).     |
| **TotalDistance**           | Distancia total recorrida en un d√≠a.                                           | Sesgo positivo. Pico en 5-12 unidades. Valores negativos presentes. Outliers recorren m√°s de 30 unidades.             |
| **TrackerDistance**         | Distancia medida autom√°ticamente por el dispositivo.                           | Similar a TotalDistance. Mayor√≠a de usuarios en 5-12 unidades. Outliers y valores negativos detectados.               |
| **LoggedActivitiesDistance**| Distancia ingresada manualmente por el usuario (actividades registradas).      | La mayor√≠a no registra actividades manuales (pico en 0). Algunos registros superan 6 unidades. Valores negativos.     |
| **VeryActiveDistance**      | Distancia recorrida durante actividades muy activas (ejercicio intenso).      | Pico en 0 (usuarios inactivos). Algunos valores extremos (>30). Valores negativos detectados.                         |
| **ModeratelyActiveDistance**| Distancia recorrida en actividades moderadas.                                  | Pico en 0. Pocos usuarios recorren entre 2 y 10 unidades. Valores negativos presentes.                                |
| **LightActiveDistance**     | Distancia recorrida en actividades ligeras (caminatas suaves).                 | Distribuci√≥n bimodal (dos grupos de usuarios). Valores extremos hasta 15 unidades. Valores negativos presentes.       |
| **SedentaryActiveDistance** | Distancia recorrida en estado sedentario (te√≥ricamente deber√≠a ser 0).        | La mayor√≠a en 0. Existen valores negativos y algunos positivos peque√±os que no tienen sentido.                        |
| **VeryActiveMinutes**       | Minutos de actividad muy intensa.                                              | Pico en 0 (usuarios que no hacen actividad intensa). Algunos superan los 200 minutos. Valores negativos detectados.   |
| **FairlyActiveMinutes**     | Minutos de actividad moderada.                                                 | Distribuci√≥n similar a VeryActiveMinutes. Pico en 0. Algunos usuarios superan los 200 minutos. Valores negativos.     |
| **LightlyActiveMinutes**    | Minutos en actividades ligeras.                                                | Distribuci√≥n bimodal. Algunos usuarios pasan m√°s de 600 minutos activos al d√≠a. Valores negativos presentes.          |
| **SedentaryMinutes**        | Minutos en actividad sedentaria.                                               | Bimodal. Picos entre 500 y 1500 minutos. Hay usuarios que superan los 1440 minutos diarios (incoherente). Valores negativos. |
| **Calories**                | Calor√≠as quemadas por d√≠a.                                                     | Pico en 1800-2500 calor√≠as. Valores extremos >6000 calor√≠as. Valores negativos, lo que es inconsistente.              |

---

## ‚úÖ **Resumen del an√°lisis de distribuci√≥n**
- La mayor√≠a de las variables tienen **sesgo positivo** (la mayor√≠a de los valores son bajos, pocos valores muy altos).
- **Valores negativos** presentes en casi todas las m√©tricas, lo cual es **inv√°lido** para distancias, tiempos y calor√≠as ‚Üí **requiere limpieza de datos**.
- **Distribuciones bimodales** en algunas variables como `LightlyActiveDistance` y `SedentaryMinutes`, lo que sugiere la **existencia de distintos perfiles de usuarios** (activos y sedentarios).
- Algunas variables exceden **l√≠mites l√≥gicos**, como m√°s de 1440 minutos en un d√≠a o calor√≠as negativas.

## Segmentaci√≥n

### Por calor√≠as
"""

# Definir los bins y etiquetas
bins = [float('-inf'), 1000, 2500, float('inf')]
labels = ['Menos de 1000', 'Entre 1000 y 2500', 'M√°s de 2500']

# Asignar los segmentos seg√∫n las calor√≠as
df['calorias_segmento'] = pd.cut(df['Calories'], bins=bins, labels=labels, include_lowest=True)

# Calcular el porcentaje de cada categor√≠a
categoria_porcentajes = df['calorias_segmento'].value_counts(normalize=True) * 100

# Crear la gr√°fica de barras
plt.figure(figsize=(8, 6))
categoria_porcentajes.plot(kind='bar', color='blue')

# Agregar t√≠tulo y etiquetas de los ejes
plt.title('Porcentaje de segmentos de calor√≠as')
plt.xlabel('Segmento de calor√≠as')  # Corregido: xlabel
plt.ylabel('Porcentaje')

# A√±adir l√≠neas de cuadr√≠cula horizontales
plt.grid(axis='y', linestyle='--', alpha=0.6)

# Mostrar valores encima de las barras
for index, value in enumerate(categoria_porcentajes):
    plt.text(index, value + 0.5, f'{value:.2f}%', color='grey', fontsize=10)

# Ajustar el dise√±o para que no se solapen los elementos
plt.tight_layout()

# Mostrar la gr√°fica
plt.show()

print(df.columns.tolist())

"""## Actuar

- Resume conclusiones y ofrece recomendaciones de estrategia.
- **Entregable:** Tres recomendaciones de alto nivel basadas en tu an√°lisis.

---

#  **Interpretaci√≥n del gr√°fico de barras: Porcentaje de segmentos de calor√≠as**

##  **Qu√© muestra el gr√°fico**
- **Tipo de gr√°fico**: Barras verticales.
- **T√≠tulo**: *Porcentaje de segmentos de calor√≠as*.
- **Eje X (Categor√≠as)**:
  1. **Entre 1000 y 2500**
  2. **M√°s de 2500**
  3. **Menos de 1000**
- **Eje Y (Porcentaje)**: Representa el porcentaje de usuarios dentro de cada rango de calor√≠as quemadas.

- Cada barra muestra adem√°s el **valor porcentual exacto** en la parte superior.

---

##  **1. Segmento: Usuarios que queman menos de 1000 calor√≠as (1.28%)**
###  **Perfil:**
- **Baja actividad f√≠sica.**
- Probablemente tienen **h√°bitos sedentarios** o **no utilizan activamente el dispositivo/app**.
- Podr√≠an ser **nuevos usuarios**, **usuarios que abandonaron** o **no han configurado bien su dispositivo**.

###  **Recomendaciones:**
1. **Campa√±as de activaci√≥n inicial o reactivaci√≥n:**
   - Enviar **recordatorios push personalizados** animando al usuario a dar sus primeros pasos de actividad.
   - Ofrecer un **tutorial interactivo** sobre c√≥mo usar Bellabeat y sus beneficios (ej: ‚ÄúC√≥mo empezar a mejorar tu salud con Bellabeat‚Äù).

2. **Desaf√≠os para principiantes:**
   - Crear **retos de bajo esfuerzo**, como caminar 500 pasos al d√≠a o 5 minutos de estiramiento, con **recompensas virtuales** (badges, puntos, etc.).
   - Ejemplo: *"Desaf√≠o 7 d√≠as activos: completa 7 d√≠as caminando al menos 1000 pasos y gana una medalla digital."*

3. **Programas de educaci√≥n y concienciaci√≥n:**
   - Notificaciones educativas con **beneficios de la actividad f√≠sica moderada** (mejor sue√±o, m√°s energ√≠a, control del estr√©s).
   - Ejemplo: *"Sab√≠as que solo 10 minutos al d√≠a de actividad pueden mejorar tu estado de √°nimo?"*

4. **Descuentos en productos Bellabeat (cross-selling):**
   - Ofrecer **descuentos exclusivos** en dispositivos m√°s sencillos o en suscripciones premium para motivar la compra y el uso.

---

##  **2. Segmento: Usuarios que queman entre 1000 y 2500 calor√≠as (62.87%)**
###  **Perfil:**
- Usuarios **moderadamente activos**.
- Mantienen un **nivel de actividad saludable**, pero a√∫n tienen **potencial de mejorar**.
- Son el **grupo m√°s representativo** del total de usuarios.

###  **Recomendaciones:**
1. **Mantenimiento de la motivaci√≥n:**
   - Ofrecer **informes semanales de progreso** que destaquen los logros recientes.
   - Ejemplo: *"¬°Felicitaciones! La semana pasada aumentaste tu actividad en un 10%."*

2. **Desaf√≠os de actividad grupales (social engagement):**
   - Crear **comunidades** donde los usuarios compitan o colaboren en retos (ej: ‚ÄúCamina 30 km con amigos esta semana‚Äù).
   - Ofrecer **tablas de clasificaci√≥n** (gamificaci√≥n) para fomentar la competencia amistosa.

3. **Recomendaciones personalizadas de estilo de vida:**
   - Sugerencias de **rutinas de ejercicio** acorde a su perfil de actividad (cardio, fuerza, yoga).
   - Tips de **nutrici√≥n y bienestar** que complementen su nivel de ejercicio.

4. **Beneficios premium o freemium:**
   - Ofrecer **pruebas gratuitas de la app premium** o nuevas funcionalidades por su compromiso.
   - Ejemplo: acceso gratuito por 30 d√≠as a **entrenamientos personalizados** o **meditaci√≥n guiada**.

---

##  **3. Segmento: Usuarios que queman m√°s de 2500 calor√≠as (35.85%)**
###  **Perfil:**
- Usuarios **altamente activos**, probablemente **deportistas regulares** o **muy comprometidos con su bienestar f√≠sico**.
- Pueden estar buscando **datos detallados de su rendimiento**, **desaf√≠os avanzados**, y **coaching personalizado**.

###  **Recomendaciones:**
1. **Programas de entrenamiento avanzados:**
   - Ofrecer **planes premium** enfocados en **rendimiento deportivo**, **entrenamiento de alta intensidad (HIIT)** o **resistencia**.
   - Incorporar recomendaciones basadas en datos biom√©tricos, como frecuencia card√≠aca o sue√±o.

2. **Coaching personalizado (monetizable):**
   - Servicios de **coaching online** o **sesiones 1 a 1** a trav√©s de la app para quienes deseen un seguimiento experto.
   - Paquetes exclusivos para deportistas o perfiles fitness avanzados.

3. **Concursos y recompensas VIP:**
   - Crear **competencias internacionales** o **desaf√≠os exclusivos** donde puedan obtener **premios tangibles** (equipamiento deportivo, membres√≠as premium, etc.).
   - Ejemplo: *‚ÄúCorre 200 km este mes y participa por un smartwatch premium.‚Äù*

4. **Datos avanzados y anal√≠tica personalizada:**
   - Ofrecer **informes detallados de performance**, como eficiencia de quema cal√≥rica por actividad, zonas de frecuencia card√≠aca, VO2 max, etc.
   - Dashboards personalizados para **visualizar progreso a largo plazo**.

---

##  **4. Recomendaciones generales para todos los segmentos**
###  **Gamificaci√≥n y motivaci√≥n**  
- Sistema de **logros y medallas** seg√∫n el progreso.
- Crear **niveles de usuario** (principiante, intermedio, avanzado) que motiven el avance.

###  **Recordatorios inteligentes y adaptativos**
- Notificaciones push **no invasivas** que **adapten su frecuencia y contenido** seg√∫n el comportamiento del usuario.
- Por ejemplo, si no abren la app en 3 d√≠as ‚Üí enviar una notificaci√≥n amable record√°ndoles los beneficios.

###  **Integraciones con otras plataformas de salud**
- Integrar Bellabeat con **Google Fit**, **Apple Health**, o apps de nutrici√≥n como **MyFitnessPal** para una visi√≥n hol√≠stica del bienestar.

---

##  **Beneficios esperados para Bellabeat**
1. **Aumento en la retenci√≥n** de usuarios a largo plazo.
2. Mejora del **engagement diario** en la app y el uso de dispositivos.
3. Incremento de las **conversiones a planes premium** y **ventas adicionales** (cross-selling).
4. Fortalecimiento de la **experiencia del cliente (UX)** y la **satisfacci√≥n del usuario**.
5. Mejor **posicionamiento competitivo** en el mercado de wellness tech.

---

##  **Ejemplo de comunicaci√≥n a los stakeholders**
> "Con base en el an√°lisis del comportamiento de los usuarios de Bellabeat, hemos segmentado la base de usuarios seg√∫n su actividad cal√≥rica diaria. Las estrategias propuestas personalizan la experiencia, incrementan la motivaci√≥n y generan nuevas oportunidades de monetizaci√≥n, consolidando a Bellabeat como l√≠der en salud digital femenina."

Link presentaci√≥n o resumen ejecutivo: https://www.canva.com/design/DAGhoEz1k54/a1QdNGJXbOUxWBje9HM4nA/edit?utm_content=DAGhoEz1k54&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton

"""

# Importaci√≥n de librer√≠as principales
import dash
from dash import dcc, html
from dash.dependencies import Input, Output
import plotly.express as px
import pandas as pd

# Cargar el dataset
# Cambia la ruta al nombre de tu dataset si es necesario
df = pd.read_csv('/content/dailyActivity_merged.csv')

# üîµ CREAR LA COLUMNA calorias_segmento ANTES DE INICIAR EL DASHBOARD

# Definir los bins y etiquetas para segmentar usuarios por calor√≠as
bins = [float('-inf'), 1000, 2500, float('inf')]
labels = ['Menos de 1000', 'Entre 1000 y 2500', 'M√°s de 2500']

# Crear la columna 'calorias_segmento'
df['calorias_segmento'] = pd.cut(df['Calories'], bins=bins, labels=labels, include_lowest=True)

# Revisa que se haya creado bien (opcional)
print(df['calorias_segmento'].value_counts())

# Inicializar la aplicaci√≥n de Dash
app = dash.Dash(__name__)

# T√≠tulo de la aplicaci√≥n
app.title = 'Dashboard Bellabeat - An√°lisis de Actividad de Usuarios'

# Layout del dashboard
app.layout = html.Div(children=[

    html.H1('Dashboard de Actividad - Bellabeat', style={'textAlign': 'center'}),

    # Dropdown para seleccionar un segmento de calor√≠as
    html.Div([
        html.Label('Segmento de Calor√≠as:'),
        dcc.Dropdown(
            id='calories_segment',
            options=[{'label': seg, 'value': seg} for seg in df['calorias_segmento'].unique()],
            value=df['calorias_segmento'].unique()[0]
        )
    ], style={'width': '40%', 'margin': 'auto'}),

    # Gr√°fico de calor√≠as
    dcc.Graph(id='calories_distribution'),

    # Gr√°fico de pasos totales
    dcc.Graph(id='steps_distribution'),

    # Gr√°fico de matriz de correlaci√≥n
    dcc.Graph(id='correlation_heatmap')

])

# Callback para actualizar gr√°ficos seg√∫n el segmento seleccionado
@app.callback(
    [Output('calories_distribution', 'figure'),
     Output('steps_distribution', 'figure'),
     Output('correlation_heatmap', 'figure')],
    [Input('calories_segment', 'value')]
)
def update_graphs(selected_segment):
    # Filtrar por el segmento de calor√≠as seleccionado
    filtered_df = df[df['calorias_segmento'] == selected_segment]

    # Gr√°fico de distribuci√≥n de calor√≠as
    fig_calories = px.histogram(filtered_df, x='Calories',
                                title=f'Distribuci√≥n de Calor√≠as - Segmento: {selected_segment}',
                                color_discrete_sequence=['#636EFA'])

    # Gr√°fico de distribuci√≥n de TotalSteps
    fig_steps = px.histogram(filtered_df, x='TotalSteps',
                             title=f'Distribuci√≥n de Pasos - Segmento: {selected_segment}',
                             color_discrete_sequence=['#EF553B'])

    # Matriz de correlaci√≥n
    correlation = filtered_df[['TotalSteps', 'Calories', 'TotalDistance', 'VeryActiveMinutes']].corr()
    fig_corr = px.imshow(correlation,
                         text_auto=True,
                         color_continuous_scale='RdBu',
                         title=f'Matriz de Correlaci√≥n - Segmento: {selected_segment}')

    return fig_calories, fig_steps, fig_corr

# Correr la app
if __name__ == '__main__':
    app.run_server(debug=True)